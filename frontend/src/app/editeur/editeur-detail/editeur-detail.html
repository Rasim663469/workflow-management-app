<section class="editeur-detail">
  <header class="detail-header">
    <div>
      <h2>Dossier éditeur</h2>
      <p class="subtitle">Gérez les contacts et les jeux associés à cet éditeur.</p>
    </div>
  </header>

  @if (editeur()) {
    <section class="editeur-overview">
      <div class="overview-main">
        @if (!editMode()) {
          <h3>{{ editeur()!.name }}</h3>
          <p>{{ editeur()!.description }}</p>
        }
        @else {
          <label class="field">
            Nom de l'éditeur
            <input
              type="text"
              [value]="editeurDraft().nom"
              (input)="updateEditeurDraftField('nom', $any($event.target).value)"
            />
          </label>
          <label class="field">
            Description
            <textarea
              rows="3"
              [value]="editeurDraft().description"
              (input)="updateEditeurDraftField('description', $any($event.target).value)"
            ></textarea>
          </label>
        }
      </div>
      <div class="overview-meta">
        @if (!editMode()) {
          <span class="pill">{{ editeur()!.type_reservant || 'Type non défini' }}</span>
          <span class="pill">{{ editeur()!.est_reservant ? 'Réservant' : 'Non réservant' }}</span>
        }
        @else {
          <label class="field">
            Type de reservant
            <select
              [value]="editeurDraft().type_reservant"
              (change)="updateEditeurDraftField('type_reservant', $any($event.target).value)"
            >
              @for (opt of typeOptions; track opt.value) {
                <option [value]="opt.value">{{ opt.label }}</option>
              }
            </select>
          </label>
          <label class="checkbox-field">
            <input
              type="checkbox"
              [checked]="editeurDraft().est_reservant"
              (change)="updateEditeurDraftField('est_reservant', $any($event.target).checked)"
            />
            Reservant pour ce festival
          </label>
        }
      </div>
      @if (canEditEditeur()) {
        <div class="overview-actions">
          @if (!editMode()) {
            <button type="button" class="ghost" (click)="startEdit()">Modifier</button>
            <button type="button" class="ghost danger" (click)="deleteEditeur()">Supprimer</button>
          }
          @else {
            <button type="button" class="ghost" (click)="cancelEdit()">Annuler</button>
            <button type="button" (click)="saveEditeur()">Enregistrer</button>
          }
        </div>
      }
    </section>
  }

  <nav class="detail-tabs">
    <button type="button" [class.active]="activeTab() === 'contacts'" (click)="setTab('contacts')">
      Contacts
    </button>
    <button type="button" [class.active]="activeTab() === 'jeux'" (click)="setTab('jeux')">
      Jeux
    </button>
  </nav>

  @if (activeTab() === 'contacts') {
    <section class="contacts-section">
      <header>
        <h3>Contacts</h3>
        <p>Ajoutez ou retirez les contacts de l'éditeur.</p>
      </header>

      @if (canManageContacts()) {
        <app-contact-form (add)="addContact($event)"></app-contact-form>
      } @else {
        <div class="placeholder">Connexion requise pour ajouter ou modifier des contacts.</div>
      }

      @if (contacts().length === 0) {
        <div class="placeholder">Aucun contact enregistré pour cet éditeur.</div>
      }
      @else {
        <div class="contacts-grid">
          @for (contact of contacts(); track contact.id) {
            <article class="contact-edit-card">
              <header>
                <strong>{{ contact.name }}</strong>
                @if (canManageContacts()) {
                  <button type="button" class="ghost danger" (click)="removeContact(contact.id)">Supprimer</button>
                }
              </header>

              <div class="contact-edit-fields">
                <label>
                  Nom complet
                  <input
                    type="text"
                    [value]="contactDraft(contact).name"
                    (input)="updateContactDraft(contact.id, 'name', $any($event.target).value)"
                    [disabled]="!canManageContacts()"
                  />
                </label>
                <label>
                  Email
                  <input
                    type="email"
                    [value]="contactDraft(contact).email"
                    (input)="updateContactDraft(contact.id, 'email', $any($event.target).value)"
                    [disabled]="!canManageContacts()"
                  />
                </label>
                <label>
                  Telephone
                  <input
                    type="tel"
                    [value]="contactDraft(contact).phone"
                    (input)="updateContactDraft(contact.id, 'phone', $any($event.target).value)"
                    [disabled]="!canManageContacts()"
                  />
                </label>
                <label>
                  Role
                  <input
                    type="text"
                    [value]="contactDraft(contact).role"
                    (input)="updateContactDraft(contact.id, 'role', $any($event.target).value)"
                    [disabled]="!canManageContacts()"
                  />
                </label>
              </div>

              @if (canManageContacts()) {
                <div class="contact-actions">
                  <button type="button" class="ghost" (click)="cancelEditContact(contact.id)">Annuler</button>
                  <button type="button" (click)="saveContact(contact.id)">Enregistrer</button>
                </div>
              }
            </article>
          }
        </div>
      }
    </section>
  }

  @if (activeTab() === 'jeux') {
    <app-editeur-jeux [editeurId]="editeurId" [editeurName]="editeur()?.name ?? ''"></app-editeur-jeux>
  }
</section>
