<section class="page">
  <header class="page-header">
    <div>
      <p class="eyebrow">Réservations</p>
      <h1>Gestion des réservations</h1>
    </div>
    <div class="selector">
      <label for="festival">Festival</label>
      <select id="festival" [value]="selectedFestivalId()" (change)="onFestivalChange($event)">
        @for (festival of festivals(); track festival.id) {
          <option [value]="festival.id">{{ festival.name }}</option>
        }
      </select>
    </div>
  </header>

  @if (loadingFestivals()) {
    <p>Chargement des festivals...</p>
  }

  @if (selectedFestivalId()) {
    <div class="tabs">
      <button type="button" class="tab" [class.active]="activeTab() === 'suivi'" (click)="activeTab.set('suivi')">
        Suivi CRM
      </button>
      <button type="button" class="tab" [class.active]="activeTab() === 'reservations'" (click)="activeTab.set('reservations')">
        Réservations
      </button>
      <button type="button" class="tab" [class.active]="activeTab() === 'nouvelle'" (click)="activeTab.set('nouvelle')">
        Nouvelle réservation
      </button>
      <button type="button" class="tab" [class.active]="activeTab() === 'jeux'" (click)="activeTab.set('jeux')">
        Jeux & placement
      </button>
      <button type="button" class="tab" [class.active]="activeTab() === 'plan'" (click)="activeTab.set('plan')">
        Zones du plan
      </button>
    </div>

    @if (activeTab() === 'suivi') {
      <app-crm-list [festivalId]="selectedFestivalId()!" />
    }

    @if (activeTab() === 'reservations') {
      <app-reservations-list
        [festivalId]="selectedFestivalId()!"
        (editRequested)="handleEditRequested($event)"
        (gamesRequested)="handleGamesRequested($event)"
      />
    }

    @if (activeTab() === 'nouvelle') {
      <app-reservation-form
        [festivalId]="selectedFestivalId()!"
        [reservationToEdit]="editingReservation()"
        (created)="handleCreated()"
        (updated)="handleUpdated()"
        (cancelled)="handleCancelled()"
      />
    }

    @if (activeTab() === 'jeux') {
      <app-reservation-games
        [festivalId]="selectedFestivalId()!"
        [festival]="currentFestival()"
        [reservation]="gamesReservation()"
      />
    }

    @if (activeTab() === 'plan') {
      <app-plan-zones [festivalId]="selectedFestivalId()!" />
    }
  } @else {
    <p>Aucun festival disponible.</p>
  }
</section>
