<h1>Administration</h1>

<section class="card">
  <header>
    <p class="eyebrow">Réservations</p>
    <h2>Gestion des réservations</h2>
    <p class="lead">Accès direct à la page dédiée (list/cards + formulaire).</p>
  </header>
  <a routerLink="/reservations" class="button-link">Ouvrir la page Réservations</a>
</section>

<section class="card">
  <header>
    <p class="eyebrow">Éditeurs</p>
    <h2>Gestion des éditeurs</h2>
    <p class="lead">Accéder à la liste des éditeurs pour en ajouter de nouveaux.</p>
  </header>
  <div class="actions">
    <a routerLink="/editeurs" class="button-link">Gérer les éditeurs</a>
    <a routerLink="/editeurs/new" class="button-link secondary">Ajouter un éditeur</a>
  </div>
</section>

<section class="card">
  <header>
    <p class="eyebrow">Jeux</p>
    <h2>Création d’un jeu</h2>
    <p class="lead">Associer un jeu à un éditeur existant.</p>
  </header>

  <form [formGroup]="formJeu" (ngSubmit)="submitJeu()">
    <div class="grid">
      <div class="field">
        <label for="nomJeu">Nom *</label>
        <input id="nomJeu" type="text" formControlName="nom" placeholder="Nom du jeu" />
        @if (formJeu.controls.nom.invalid && formJeu.controls.nom.touched) {
        <p class="error">Le nom du jeu est obligatoire.</p>
        }
      </div>

      <div class="field">
        <label for="editeurId">Éditeur *</label>
        <select id="editeurId" formControlName="editeur_id">
          <option [ngValue]="null">Sélectionner</option>
          @for (editeur of editeurs(); track editeur.id) {
          <option [ngValue]="editeur.id">{{ editeur.name }}</option>
          }
        </select>
        @if (formJeu.controls.editeur_id.invalid && formJeu.controls.editeur_id.touched) {
        <p class="error">Choisissez un éditeur.</p>
        }
      </div>
    </div>

    <div class="field">
      <label for="auteurs">Auteurs</label>
      <input id="auteurs" type="text" formControlName="auteurs" placeholder="Auteur(s)" />
    </div>

    <div class="grid">
      <div class="field">
        <label for="ageMin">Âge minimum</label>
        <input id="ageMin" type="number" formControlName="age_min" min="0" />
      </div>
      <div class="field">
        <label for="ageMax">Âge maximum</label>
        <input id="ageMax" type="number" formControlName="age_max" min="0" />
      </div>
    </div>

    <div class="field">
      <label for="typeJeu">Type de jeu</label>
      <select id="typeJeu" formControlName="type_jeu">
        <option [ngValue]="''">Type non spécifié</option>
        @for (type of types(); track type.id) {
        <option [ngValue]="type.libelle">{{ type.libelle }}</option>
        }
      </select>
    </div>

    <button type="submit" [disabled]="creatingJeu() || formJeu.invalid">
      {{ creatingJeu() ? 'Création...' : 'Créer le jeu' }}
    </button>

    @if (jeuSuccess()) {
    <p class="success">{{ jeuSuccess() }}</p>
    }
    @if (jeuError()) {
    <p class="error">{{ jeuError() }}</p>
    }
  </form>
</section>

<section class="card">
  <header>
    <p class="eyebrow">Utilisateurs</p>
    <h2>Créer un utilisateur</h2>
    <p class="lead">Créer un compte et définir son rôle.</p>
  </header>

  <form [formGroup]="formUser" (ngSubmit)="submitUser()">
    <div class="grid">
      <div class="field">
        <label for="loginUser">Login *</label>
        <input id="loginUser" type="text" formControlName="login" placeholder="Login" />
        @if (formUser.controls.login.invalid && formUser.controls.login.touched) {
        <p class="error">Login obligatoire (2 caractères min).</p>
        }
      </div>
      <div class="field">
        <label for="passwordUser">Mot de passe *</label>
        <input id="passwordUser" type="password" formControlName="password" placeholder="Mot de passe" />
        @if (formUser.controls.password.invalid && formUser.controls.password.touched) {
        <p class="error">Mot de passe obligatoire (4 caractères min).</p>
        }
      </div>
      <div class="field">
        <label for="roleUser">Rôle *</label>
        <select id="roleUser" formControlName="role">
          @for (role of roles; track role.value) {
          <option [ngValue]="role.value">{{ role.label }}</option>
          }
        </select>
      </div>
    </div>

    <button type="submit" [disabled]="creatingUser() || formUser.invalid">
      {{ creatingUser() ? 'Création...' : 'Créer l’utilisateur' }}
    </button>

    @if (userSuccess()) {
    <p class="success">{{ userSuccess() }}</p>
    }
    @if (userError()) {
    <p class="error">{{ userError() }}</p>
    }
  </form>
</section>

<section class="card">
  <h3>Utilisateurs</h3>
  @for (user of users(); track user.login) {
  <div class="user-card">
    <div>
      <h3>{{ user.login }}</h3>
      <p>Rôle actuel : {{ user.role }}</p>
    </div>
    @if (user.id) {
      <div class="field inline">
        <label>Changer rôle</label>
        <select #roleSelect>
          @for (role of roles; track role.value) {
          <option [value]="role.value" [selected]="role.value === user.role">
            {{ role.label }}
          </option>
          }
        </select>
        <button
          type="button"
          class="secondary"
          (click)="updateRole(user.id!, toRole(roleSelect.value))"
          [disabled]="updatingRoles()[user.id!]"
        >
          Mettre à jour
        </button>
        <button
          type="button"
          class="secondary danger"
          (click)="deleteUser(user.id!)"
          [disabled]="deletingUsers()[user.id!]"
        >
          Supprimer
        </button>
      </div>
    }
  </div>
  }
  @if (users().length === 0) {
  <p>Aucun utilisateur pour le moment.</p>
  }
</section>
